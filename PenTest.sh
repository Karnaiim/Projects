#!/bin/bash

# Function to perform network scan. the user chooses which one they'd like to scan.
function perform_network_scan() {
    echo "Please state a network you'd like to scan:"
    read -r network
    echo "Enter a name for an Output Directory:"
    read -r output_dir

    # The command that creates the output directory if it doesn't exist.
    mkdir -p "$output_dir"
    echo "Running network scan..."

    # The following nmap syntax allows the user to have a basic scanning of the ip addresses in the network range.
    sudo nmap -sn "$network" -oN "$output_dir/network_scan_results.txt"
    echo -e "Scanning complete! Results saved to: $output_dir/network_scan_results.txt\n"
}

# Function to perform a full scan on a specific IP in the range.
function perform_full_scan() {
    echo "Enter the IP address that you would like to scan for vulnerabilities:"
    read -r target_ip
    echo "Running full scan.."

    # Using Nmap to perform a full scan on the IP the user chooses, saving it as results.txt.
    # This allows the user to find the Vulnerabilities that exist on the network and possible servers that are known to be breecheble.
    sudo nmap -p- -sV -sC "$target_ip" -oN "kali/scan_results.txt"

    # The following command is meant to give the user the choice to use the default password.lst or input their own.
    # 'weak credentials' file saves weak passwords found during the scan.
    # 'brute force' is a function that is meant to brute-force any existing IP that was found in the network.
    weak_credentials "$target_ip" "kali"
    prompt_for_password

    echo "Using password list: $hydra_password_list"
}

# Function to prompt the user for password list.
function prompt_for_password() {
    echo "Choose the file list you want to use:"
    echo "1. Use your own password list"
    echo "2. Use default password list"
    read -r choice

    case "$choice" in
        1)
            echo "Enter the path to your password list:"
            read -r custom_password_list
            hydra_password_list="$custom_password_list"
            ;;
        2)
            hydra_password_list="/home/kali/Desktop/hydra_pass.txt"
            ;;
        *)
            echo "Invalid choice. Using default password list"
            hydra_password_list="/home/kali/Desktop/hydra_pass.txt"
            ;;
    esac
}

# Function to check weak credentials using Hydra.
function weak_credentials() {
    local target_ip="$1"
    local output_dir="$2"
    local hydra_user_list="/home/kali/Desktop/hydra_user.txt"

    echo "Checking ssh on $target_ip..."
    hydra -L "$hydra_user_list" -P "$hydra_password_list" -t 4 "$target_ip" ssh > "$output_dir/weak_credentials_ssh.txt" 2>/dev/null
    echo -e "Weak credentials check for ssh saved to: $output_dir/weak_credentials_ssh.txt\n"

    # Similar checks for other services like rdp, ftp, telnet
}

# Function to compress results into zip file.
function save_results_to_zip() {
    echo "Enter a name for the zip file:"
    read -r zip_filename
    echo "Compressing results into $zip_filename.zip..."
    zip -r "$zip_filename.zip" "kali"
    echo -e "Results compressed into: $zip_filename.zip\n"
}

# Main menu loop
while true; do
    echo "1. Perform network scan"
    echo "2. Perform full scan on specific IP"
    echo "3. Save results to zip file"
    echo "4. Quit"

    read -r choice

    case "$choice" in
        1) perform_network_scan ;;
        2) perform_full_scan ;;
        3) save_results_to_zip ;;
        4) echo "Goodbye!"
           exit ;;
        *) echo "Invalid choice!" ;;
    esac
done

